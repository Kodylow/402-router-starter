import{TypeSystem as e}from"@sinclair/typebox/system";import{Type as t,FormatRegistry as r}from"@sinclair/typebox";import{Value as i}from"@sinclair/typebox/value";import{ValidationError as n}from"./error";let a=Object.assign({},t);try{e.Format("email",e=>/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(e)),e.Format("uuid",e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)),e.Format("date",e=>!Number.isNaN(new Date(e).getTime())),e.Format("date-time",e=>!Number.isNaN(new Date(e).getTime()))}catch(e){}let s=e=>{if("string"==typeof e)switch(e.slice(-1)){case"k":return 1024*+e.slice(0,e.length-1);case"m":return 1048576*+e.slice(0,e.length-1);default:return+e}return e},o=(e,t)=>{if(!(t instanceof Blob)||e.minSize&&t.size<s(e.minSize)||e.maxSize&&t.size>s(e.maxSize))return!1;if(e.extension){if("string"==typeof e.extension){if(!t.type.startsWith(e.extension))return!1}else{for(let r=0;r<e.extension.length;r++)if(t.type.startsWith(e.extension[r]))return!0;return!1}}return!0},l=e.Type("Files",(e,t)=>{if(!Array.isArray(t))return o(e,t);if(e.minItems&&t.length<e.minItems||e.maxItems&&t.length>e.maxItems)return!1;for(let r=0;r<t.length;r++)if(!o(e,t[r]))return!1;return!0});r.Set("numeric",e=>!!e&&!isNaN(+e)),r.Set("ObjectString",e=>{let t=e.charCodeAt(0);if((9===t||10===t||32===t)&&(t=e.trimStart().charCodeAt(0)),123!==t&&91!==t)return!1;try{return JSON.parse(e),!0}catch{return!1}});export const ElysiaType={Numeric:e=>{let r=t.Number(e);return a.Transform(a.Union([a.String({format:"numeric",default:0}),a.Number(e)],e)).Decode(t=>{let a=+t;if(isNaN(a))return t;if(e&&!i.Check(r,a))throw new n("property",r,a);return a}).Encode(e=>e)},ObjectString:(e,t)=>a.Transform(a.Union([a.String({format:"ObjectString",default:""}),a.Object(e,t)],t)).Decode(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}).Encode(e=>JSON.stringify(e)),File:e.Type("File",o),Files:(e={})=>a.Transform(a.Union([l(e)])).Decode(e=>Array.isArray(e)?e:[e]).Encode(e=>e),Nullable:e=>a.Union([a.Null(),e]),MaybeEmpty:e=>a.Union([a.Null(),a.Undefined(),e]),Cookie:(e,t)=>a.Object(e,t)};a.ObjectString=ElysiaType.ObjectString,a.Numeric=ElysiaType.Numeric,a.File=(e={})=>ElysiaType.File({default:"File",...e,extension:e?.type,type:"string",format:"binary"}),a.Files=(e={})=>ElysiaType.Files({...e,elysiaMeta:"Files",default:"Files",extension:e?.type,type:"array",items:{...e,default:"Files",type:"string",format:"binary"}}),a.Nullable=e=>ElysiaType.Nullable(e),a.MaybeEmpty=ElysiaType.MaybeEmpty,a.Cookie=ElysiaType.Cookie;export*from"@sinclair/typebox/system";export*from"@sinclair/typebox/compiler";export{a as t};